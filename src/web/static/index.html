<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Dorker - Enhanced Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h3 {
            color: #5a67d8;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 10px;
            color: white;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .websocket-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e53e3e;
            transition: background 0.3s;
        }

        .status-indicator.connected {
            background: #38a169;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #5a67d8;
            color: white;
        }

        .btn-primary:hover {
            background: #4c51bf;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
        }

        .btn-danger:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #3182ce);
            transition: width 0.5s ease;
            width: 0%;
        }

        .job-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .job-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.5);
            transition: transform 0.2s;
        }

        .job-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .job-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .job-company {
            color: #5a67d8;
            font-weight: 500;
        }

        .job-meta {
            color: #718096;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .log-entry {
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 6px;
            font-size: 0.9em;
            border-left: 3px solid #4299e1;
            background: rgba(66, 153, 225, 0.1);
        }

        .log-entry.error {
            border-left-color: #e53e3e;
            background: rgba(229, 62, 62, 0.1);
        }

        .log-entry.success {
            border-left-color: #38a169;
            background: rgba(56, 161, 105, 0.1);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ Job Dorker</h1>
            <p class="subtitle">Enhanced Real-Time Job Search Dashboard</p>
        </header>

        <!-- Priority 1: Search Functionality -->
        <div class="search-section">
            <div class="search-header">
                <h2>üîç Quick Job Search</h2>
                <p>Search for jobs by title, company, skills, or location</p>
            </div>
            
            <div class="search-input-group">
                <input type="text" id="main-search" placeholder="Search jobs: e.g. 'Software Engineer' or 'Remote Python Developer'" 
                       class="main-search-input">
                <button id="search-btn" class="search-button">
                    <span>üîç</span> Search
                </button>
                <button id="advanced-search-btn" class="search-button secondary">
                    <span>‚öôÔ∏è</span> Advanced
                </button>
            </div>
            
            <div class="search-suggestions" id="search-suggestions"></div>
            
            <!-- Search Results Summary -->
            <div class="search-results-summary" id="search-results-summary" style="display: none;">
                <div class="summary-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="search-total-results">0</span>
                        <span class="stat-label">Results Found</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="search-remote-jobs">0</span>
                        <span class="stat-label">Remote</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="search-avg-salary">$0</span>
                        <span class="stat-label">Avg. Salary</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="search-new-today">0</span>
                        <span class="stat-label">New Today</span>
                    </div>
                </div>
                <div class="search-actions">
                    <button id="clear-search" class="action-btn secondary">
                        üóëÔ∏è Clear
                    </button>
                    <button id="export-search" class="action-btn primary">
                        üìÅ Export
                    </button>
                </div>
            </div>
            
            <!-- Quick Search Results -->
            <div class="quick-search-results" id="quick-search-results" style="display: none;">
                <div class="results-header">
                    <h3>üéØ Search Results</h3>
                    <div class="results-count">
                        Showing <span id="results-showing">0</span> of <span id="results-total">0</span> jobs
                    </div>
                </div>
                <div class="results-list" id="results-list">
                    <!-- Search results will be populated here -->
                </div>
                <div class="results-pagination" id="results-pagination">
                    <button id="prev-results" class="page-btn" disabled>‚Üê Previous</button>
                    <span class="page-info">Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>
                    <button id="next-results" class="page-btn" disabled>Next ‚Üí</button>
                </div>
            </div>
        </div>

        <div class="dashboard">
            <!-- WebSocket Status Card -->
            <div class="card">
                <h3>üîó Connection Status</h3>
                <div class="websocket-status">
                    <div class="status-indicator" id="wsStatus"></div>
                    <span id="wsStatusText">Disconnected</span>
                </div>
                <p id="wsInfo">Connecting to real-time updates...</p>
            </div>

            <!-- Real-Time Statistics -->
            <div class="card">
                <h3>üìä Live Statistics</h3>
                <div class="stats-grid">
                    <div class="stat">
                        <div class="stat-value" id="totalJobs">0</div>
                        <div class="stat-label">Total Jobs</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="totalCompanies">0</div>
                        <div class="stat-label">Companies</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="remoteJobs">0</div>
                        <div class="stat-label">Remote Jobs</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="avgSalary">$0</div>
                        <div class="stat-label">Avg Salary</div>
                    </div>
                </div>
            </div>

            <!-- Scraping Controls -->
            <div class="card">
                <h3>‚ö° Scraping Controls</h3>
                <div id="scrapingStatus">
                    <p><strong>Status:</strong> <span id="scrapingState">Idle</span></p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar"></div>
                    </div>
                    <p><small>Progress: <span id="progressText">0%</span></small></p>
                </div>
                <div class="controls">
                    <button class="btn-primary" onclick="startScraping()">Start Scraping</button>
                    <button class="btn-danger" onclick="stopScraping()">Stop Scraping</button>
                </div>
            </div>

            <!-- Recent Jobs -->
            <div class="card">
                <h3>üÜï Recent Jobs</h3>
                <div class="job-list" id="jobList">
                    <p style="text-align: center; color: #718096;">No recent jobs yet...</p>
                </div>
            </div>

            <!-- Activity Log -->
            <div class="card">
                <h3>üìù Activity Log</h3>
                <div id="activityLog" style="max-height: 300px; overflow-y: auto;">
                    <div class="log-entry">Dashboard initialized</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class JobDorkerDashboard {
            constructor() {
                this.ws = null;
                this.reconnectAttempts = 0;
                this.maxReconnectAttempts = 5;
                this.reconnectDelay = 3000;
                
                this.initializeWebSocket();
                this.loadInitialData();
            }

            initializeWebSocket() {
                const wsUrl = `ws://${window.location.host}/ws`;
                this.log('Connecting to WebSocket...', 'info');
                
                try {
                    this.ws = new WebSocket(wsUrl);
                    
                    this.ws.onopen = () => {
                        this.onWebSocketOpen();
                    };
                    
                    this.ws.onmessage = (event) => {
                        this.onWebSocketMessage(event);
                    };
                    
                    this.ws.onclose = () => {
                        this.onWebSocketClose();
                    };
                    
                    this.ws.onerror = (error) => {
                        this.onWebSocketError(error);
                    };
                } catch (error) {
                    this.log('Failed to create WebSocket connection', 'error');
                    this.updateConnectionStatus(false);
                }
            }

            onWebSocketOpen() {
                this.log('‚úÖ Connected to real-time updates', 'success');
                this.updateConnectionStatus(true);
                this.reconnectAttempts = 0;
                
                // Send ping to test connection
                this.sendMessage({ type: 'ping' });
            }

            onWebSocketMessage(event) {
                try {
                    const message = JSON.parse(event.data);
                    this.handleMessage(message);
                } catch (error) {
                    this.log('Failed to parse WebSocket message', 'error');
                }
            }

            onWebSocketClose() {
                this.log('üîå WebSocket connection closed', 'info');
                this.updateConnectionStatus(false);
                
                if (this.reconnectAttempts < this.maxReconnectAttempts) {
                    this.scheduleReconnect();
                }
            }

            onWebSocketError(error) {
                this.log('‚ùå WebSocket error occurred', 'error');
                this.updateConnectionStatus(false);
            }

            scheduleReconnect() {
                this.reconnectAttempts++;
                this.log(`Reconnecting in ${this.reconnectDelay/1000}s (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`, 'info');
                
                setTimeout(() => {
                    this.initializeWebSocket();
                }, this.reconnectDelay);
                
                this.reconnectDelay *= 1.5; // Exponential backoff
            }

            handleMessage(message) {
                switch (message.type) {
                    case 'pong':
                        this.log('üèì Connection confirmed', 'success');
                        break;
                        
                    case 'scraping-status':
                        this.updateScrapingStatus(message.data);
                        break;
                        
                    case 'new-job':
                        this.addNewJob(message.data);
                        break;
                        
                    case 'status':
                        this.updateScrapingStatus(message.data);
                        break;
                        
                    default:
                        this.log(`Unknown message type: ${message.type}`, 'info');
                }
            }

            sendMessage(message) {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify(message));
                }
            }

            updateConnectionStatus(connected) {
                const indicator = document.getElementById('wsStatus');
                const statusText = document.getElementById('wsStatusText');
                const info = document.getElementById('wsInfo');
                
                if (connected) {
                    indicator.classList.add('connected');
                    statusText.textContent = 'Connected';
                    info.textContent = 'Real-time updates active';
                } else {
                    indicator.classList.remove('connected');
                    statusText.textContent = 'Disconnected';
                    info.textContent = 'Attempting to reconnect...';
                }
            }

            updateScrapingStatus(status) {
                const state = document.getElementById('scrapingState');
                const progressBar = document.getElementById('progressBar');
                const progressText = document.getElementById('progressText');
                
                state.textContent = status.active ? 'Active' : 'Idle';
                progressBar.style.width = `${status.progress || 0}%`;
                progressText.textContent = `${status.progress || 0}%`;
                
                if (status.active) {
                    this.log(`üìä Scraping progress: ${status.progress}% (${status.totalJobs || 0} jobs found)`, 'info');
                }
            }

            addNewJob(job) {
                const jobList = document.getElementById('jobList');
                const jobItem = document.createElement('div');
                jobItem.className = 'job-item';
                jobItem.style.animation = 'fadeIn 0.5s ease';
                
                jobItem.innerHTML = `
                    <div class="job-title">${job.title}</div>
                    <div class="job-company">${job.company}</div>
                    <div class="job-meta">
                        üìç ${job.location} ‚Ä¢ 
                        ${job.remote ? 'üè† Remote' : 'üè¢ On-site'} ‚Ä¢ 
                        üí∞ ${job.salary ? `$${job.salary.min}-${job.salary.max}` : 'Salary not specified'}
                    </div>
                `;
                
                // Add to top of list
                if (jobList.firstChild && jobList.firstChild.tagName) {
                    jobList.insertBefore(jobItem, jobList.firstChild);
                } else {
                    jobList.innerHTML = '';
                    jobList.appendChild(jobItem);
                }
                
                // Keep only last 10 jobs
                while (jobList.children.length > 10) {
                    jobList.removeChild(jobList.lastChild);
                }
                
                this.log(`üÜï New job: ${job.title} at ${job.company}`, 'success');
            }

            async loadInitialData() {
                try {
                    const response = await fetch('/api/v2/stats');
                    const data = await response.json();
                    
                    document.getElementById('totalJobs').textContent = data.totalJobs || 0;
                    document.getElementById('totalCompanies').textContent = data.totalCompanies || 0;
                    document.getElementById('remoteJobs').textContent = data.remoteJobs || 0;
                    document.getElementById('avgSalary').textContent = data.averageSalary ? 
                        `$${data.averageSalary.toLocaleString()}` : '$0';
                    
                    this.log('üìä Statistics loaded', 'success');
                } catch (error) {
                    this.log('Failed to load initial statistics', 'error');
                }
            }

            log(message, type = 'info') {
                const logContainer = document.getElementById('activityLog');
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${type}`;
                logEntry.innerHTML = `<small>${new Date().toLocaleTimeString()}</small> ${message}`;
                
                logContainer.insertBefore(logEntry, logContainer.firstChild);
                
                // Keep only last 20 entries
                while (logContainer.children.length > 20) {
                    logContainer.removeChild(logContainer.lastChild);
                }
            }
        }

        // Global functions for button controls
        async function startScraping() {
            try {
                const response = await fetch('/api/v2/scraping/start', {
                    method: 'POST'
                });
                const data = await response.json();
                dashboard.log('üöÄ Scraping started', 'success');
            } catch (error) {
                dashboard.log('‚ùå Failed to start scraping', 'error');
            }
        }

        async function stopScraping() {
            try {
                const response = await fetch('/api/v2/scraping/stop', {
                    method: 'POST'
                });
                const data = await response.json();
                dashboard.log('‚èπÔ∏è Scraping stopped', 'info');
            } catch (error) {
                dashboard.log('‚ùå Failed to stop scraping', 'error');
            }
        }

        // Priority 1: Search Functionality Implementation
        class SearchManager {
            constructor() {
                this.searchInput = document.getElementById('main-search');
                this.searchBtn = document.getElementById('search-btn');
                this.searchSuggestions = document.getElementById('search-suggestions');
                this.resultsContainer = document.getElementById('search-quick-results');
                this.resultsSummary = document.getElementById('search-results-summary');
                this.totalResults = document.getElementById('search-total-results');
                this.remoteJobsCount = document.getElementById('search-remote-jobs');
                this.avgSalary = document.getElementById('search-avg-salary');
                this.pagination = document.getElementById('search-pagination');
                
                this.currentQuery = '';
                this.currentPage = 1;
                this.resultsPerPage = 10;
                this.totalJobsCount = 0;
                
                this.initializeSearch();
            }

            initializeSearch() {
                // Search button click handler
                this.searchBtn.addEventListener('click', () => this.performSearch());
                
                // Enter key handler for search input
                this.searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch();
                    }
                });
                
                // Real-time search suggestions (debounced)
                let searchTimeout;
                this.searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        this.showSearchSuggestions(e.target.value);
                    }, 300);
                });
                
                // Pagination handlers
                document.getElementById('prev-results').addEventListener('click', () => {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.performSearch(false);
                    }
                });
                
                document.getElementById('next-results').addEventListener('click', () => {
                    const totalPages = Math.ceil(this.totalJobsCount / this.resultsPerPage);
                    if (this.currentPage < totalPages) {
                        this.currentPage++;
                        this.performSearch(false);
                    }
                });
            }

            async performSearch(resetPage = true) {
                const query = this.searchInput.value.trim();
                
                if (!query) {
                    this.hideSearchResults();
                    return;
                }
                
                if (resetPage) {
                    this.currentPage = 1;
                }
                
                this.currentQuery = query;
                this.showLoadingState();
                
                try {
                    const offset = (this.currentPage - 1) * this.resultsPerPage;
                    const response = await fetch('/api/v1/jobs/search', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            query: query,
                            limit: this.resultsPerPage,
                            offset: offset
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Search failed: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    this.displaySearchResults(data);
                    dashboard.log(`üîç Search completed: "${query}" - ${data.results.length} results`, 'success');
                    
                } catch (error) {
                    console.error('Search error:', error);
                    this.showErrorState(error.message);
                    dashboard.log(`‚ùå Search failed: ${error.message}`, 'error');
                }
            }

            showLoadingState() {
                this.searchBtn.disabled = true;
                this.searchBtn.innerHTML = '<span>‚è≥</span> Searching...';
                this.resultsContainer.innerHTML = '<div class="loading-state">üîç Searching for jobs...</div>';
                this.resultsSummary.style.display = 'block';
            }

            displaySearchResults(data) {
                this.searchBtn.disabled = false;
                this.searchBtn.innerHTML = '<span>üîç</span> Search';
                
                const { results, query, pagination } = data;
                this.totalJobsCount = pagination.total;
                
                // Update results summary
                this.totalResults.textContent = pagination.total.toLocaleString();
                
                // Calculate remote jobs and average salary
                const remoteJobs = results.filter(job => job.remote || job.location?.toLowerCase().includes('remote')).length;
                const salaries = results.filter(job => job.salary?.min && job.salary?.max).map(job => (job.salary.min + job.salary.max) / 2);
                const avgSalary = salaries.length > 0 ? salaries.reduce((a, b) => a + b, 0) / salaries.length : 0;
                
                this.remoteJobsCount.textContent = remoteJobs;
                this.avgSalary.textContent = avgSalary > 0 ? `$${Math.round(avgSalary).toLocaleString()}` : 'N/A';
                
                // Display results
                if (results.length === 0) {
                    this.resultsContainer.innerHTML = `
                        <div class="no-results">
                            <p>üîç No jobs found for "${query}"</p>
                            <p>Try different keywords or check the spelling</p>
                        </div>
                    `;
                } else {
                    this.resultsContainer.innerHTML = results.map(job => this.createJobCard(job)).join('');
                }
                
                // Update pagination
                this.updatePagination();
                this.resultsSummary.style.display = 'block';
            }

            createJobCard(job) {
                const salaryInfo = job.salary && job.salary.min && job.salary.max 
                    ? `üí∞ $${job.salary.min.toLocaleString()} - $${job.salary.max.toLocaleString()}`
                    : 'üí∞ Salary not specified';
                
                const remoteIcon = job.remote || job.location?.toLowerCase().includes('remote') ? 'üè†' : 'üè¢';
                const locationText = job.location || 'Location not specified';
                
                return `
                    <div class="job-card" data-job-id="${job.id}">
                        <div class="job-header">
                            <h4 class="job-title">${job.title}</h4>
                            <div class="job-company">${job.company}</div>
                        </div>
                        <div class="job-meta">
                            <span class="job-location">${remoteIcon} ${locationText}</span>
                            <span class="job-salary">${salaryInfo}</span>
                        </div>
                        ${job.description ? `<div class="job-description">${job.description.substring(0, 150)}...</div>` : ''}
                        <div class="job-actions">
                            <button class="btn-primary" onclick="viewJobDetails('${job.id}')">View Details</button>
                            <button class="btn-secondary" onclick="saveJob('${job.id}')">Save Job</button>
                        </div>
                        <div class="job-timestamp">
                            Posted: ${new Date(job.createdAt).toLocaleDateString()}
                        </div>
                    </div>
                `;
            }

            updatePagination() {
                const totalPages = Math.ceil(this.totalJobsCount / this.resultsPerPage);
                
                document.getElementById('current-page').textContent = this.currentPage;
                document.getElementById('total-pages').textContent = totalPages;
                
                document.getElementById('prev-results').disabled = this.currentPage <= 1;
                document.getElementById('next-results').disabled = this.currentPage >= totalPages;
                
                this.pagination.style.display = totalPages > 1 ? 'flex' : 'none';
            }

            showSearchSuggestions(query) {
                if (!query || query.length < 2) {
                    this.searchSuggestions.style.display = 'none';
                    return;
                }
                
                // Simple search suggestions based on common job titles and keywords
                const suggestions = [
                    'Software Engineer', 'Frontend Developer', 'Backend Developer', 'Full Stack Developer',
                    'Data Scientist', 'Product Manager', 'DevOps Engineer', 'UX Designer', 'UI Designer',
                    'Java Developer', 'Python Developer', 'JavaScript Developer', 'React Developer',
                    'Node.js Developer', 'Remote Jobs', 'Senior Developer', 'Junior Developer'
                ].filter(suggestion => 
                    suggestion.toLowerCase().includes(query.toLowerCase())
                ).slice(0, 5);
                
                if (suggestions.length > 0) {
                    this.searchSuggestions.innerHTML = suggestions.map(suggestion => 
                        `<div class="suggestion-item" onclick="searchManager.selectSuggestion('${suggestion}')">${suggestion}</div>`
                    ).join('');
                    this.searchSuggestions.style.display = 'block';
                } else {
                    this.searchSuggestions.style.display = 'none';
                }
            }

            selectSuggestion(suggestion) {
                this.searchInput.value = suggestion;
                this.searchSuggestions.style.display = 'none';
                this.performSearch();
            }

            hideSearchResults() {
                this.resultsSummary.style.display = 'none';
                this.searchSuggestions.style.display = 'none';
            }

            showErrorState(message) {
                this.searchBtn.disabled = false;
                this.searchBtn.innerHTML = '<span>üîç</span> Search';
                this.resultsContainer.innerHTML = `
                    <div class="error-state">
                        <p>‚ùå Search failed: ${message}</p>
                        <button onclick="searchManager.performSearch()" class="btn-primary">Try Again</button>
                    </div>
                `;
            }
        }

        // Global functions for job actions
        async function viewJobDetails(jobId) {
            try {
                const response = await fetch(`/api/v1/jobs/${jobId}`);
                const data = await response.json();
                
                // Create a modal or redirect to job details page
                dashboard.log(`üëÅÔ∏è Viewing job: ${data.job.title} at ${data.job.company}`, 'info');
                
                // For now, just show an alert with job details
                alert(`
Job: ${data.job.title}
Company: ${data.job.company}
Location: ${data.job.location || 'Not specified'}
Remote: ${data.job.remote ? 'Yes' : 'No'}
Salary: ${data.job.salary ? `$${data.job.salary.min}-${data.job.salary.max}` : 'Not specified'}

Description:
${data.job.description || 'No description available'}
                `);
            } catch (error) {
                dashboard.log(`‚ùå Failed to load job details: ${error.message}`, 'error');
            }
        }

        async function saveJob(jobId) {
            // This would integrate with a job saving system
            dashboard.log(`üíæ Job saved: ${jobId}`, 'success');
            alert('Job saved to your favorites! (Feature coming soon)');
        }

        // Initialize search manager and dashboard when page loads
        let dashboard;
        let searchManager;
        document.addEventListener('DOMContentLoaded', () => {
            dashboard = new JobDorkerDashboard();
            searchManager = new SearchManager();
        });

        // Add CSS animation and search styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(-10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            /* Search Results Styling */
            .job-card {
                background: white;
                border-radius: 8px;
                padding: 16px;
                margin-bottom: 12px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                border-left: 4px solid #3182ce;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
            
            .job-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            }
            
            .job-header {
                margin-bottom: 8px;
            }
            
            .job-title {
                margin: 0 0 4px 0;
                color: #2d3748;
                font-size: 18px;
                font-weight: 600;
            }
            
            .job-company {
                color: #4a5568;
                font-weight: 500;
                font-size: 14px;
            }
            
            .job-meta {
                display: flex;
                gap: 16px;
                margin: 8px 0;
                font-size: 14px;
                color: #718096;
            }
            
            .job-location, .job-salary {
                display: flex;
                align-items: center;
                gap: 4px;
            }
            
            .job-description {
                margin: 12px 0;
                color: #4a5568;
                line-height: 1.5;
                font-size: 14px;
            }
            
            .job-actions {
                display: flex;
                gap: 8px;
                margin-top: 12px;
            }
            
            .job-actions button {
                padding: 6px 12px;
                border-radius: 4px;
                border: none;
                cursor: pointer;
                font-size: 12px;
                font-weight: 500;
                transition: background-color 0.2s ease;
            }
            
            .btn-primary {
                background-color: #3182ce;
                color: white;
            }
            
            .btn-primary:hover {
                background-color: #2c5aa0;
            }
            
            .btn-secondary {
                background-color: #e2e8f0;
                color: #4a5568;
            }
            
            .btn-secondary:hover {
                background-color: #cbd5e0;
            }
            
            .job-timestamp {
                margin-top: 8px;
                font-size: 12px;
                color: #a0aec0;
            }
            
            /* Search Suggestions */
            .search-suggestions {
                position: absolute;
                top: 100%;
                left: 0;
                right: 60px;
                background: white;
                border: 1px solid #e2e8f0;
                border-radius: 0 0 8px 8px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                z-index: 1000;
                max-height: 200px;
                overflow-y: auto;
            }
            
            .suggestion-item {
                padding: 8px 12px;
                cursor: pointer;
                border-bottom: 1px solid #f7fafc;
                transition: background-color 0.2s ease;
            }
            
            .suggestion-item:hover {
                background-color: #f7fafc;
            }
            
            .suggestion-item:last-child {
                border-bottom: none;
            }
            
            /* Loading and Error States */
            .loading-state, .no-results, .error-state {
                text-align: center;
                padding: 40px 20px;
                color: #718096;
            }
            
            .loading-state {
                background: #f7fafc;
                border-radius: 8px;
                margin: 20px 0;
            }
            
            .no-results {
                background: #fffbf0;
                border: 1px solid #f6e05e;
                border-radius: 8px;
                margin: 20px 0;
            }
            
            .error-state {
                background: #fed7d7;
                border: 1px solid #fc8181;
                border-radius: 8px;
                margin: 20px 0;
            }
            
            /* Pagination styling improvements */
            #search-pagination {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 12px;
                margin-top: 20px;
                padding: 16px;
                background: #f7fafc;
                border-radius: 8px;
            }
            
            .page-btn {
                padding: 8px 16px;
                background-color: #3182ce;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-weight: 500;
                transition: background-color 0.2s ease;
            }
            
            .page-btn:hover:not(:disabled) {
                background-color: #2c5aa0;
            }
            
            .page-btn:disabled {
                background-color: #cbd5e0;
                color: #a0aec0;
                cursor: not-allowed;
            }
            
            .page-info {
                font-weight: 500;
                color: #4a5568;
            }
            
            /* Search input group positioning */
            .search-input-group {
                position: relative;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
